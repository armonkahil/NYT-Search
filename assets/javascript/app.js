// **!! Test to confirm that the query URL Works, only uncomment if needed!!**

// var searchTerm = "nasdaq";
// var apiKey = "i3CLhoOrDO85BXLwQtg491dkQ8Gb6If1";
// var numRecords = "";
// var startYear = "20190101";
// var endYear = "20190912";
// var queryURL =
//   "https://api.nytimes.com/svc/search/v2/articlesearch.json?q=" +
//   searchTerm +
//   "&begin_date=" +
//   startYear +
//   "&end_date=" +
//   endYear +
//   "&api-key=" +
//   apiKey;

// console.log(queryURL);
// **!! Right now this only pulls the first record from the response !!**
//NOTICE: you need to pass the queryURL from the .submit function in order for the display to work. This is a problem
function displaySearchInfo(queryURL,num) {
    console.log("running displaySearchInfo");
    console.log(num);
  $.ajax({
    url: queryURL,
    method: "GET"
  }).then(function (taco) {
    console.log("this is response object ",taco.response.docs);

    if (num > taco.response.docs.length) {
        num=taco.length;
    }
    for (i=0; i < num; i++) {
         var articleDiv = $("<div class = 'card mb-4'>");

    // about the article, create <p> for headline, append <p> to article div
    var articleHeadline = taco.response.docs[num].headline.main;
    var pOne = $('<p class="card-header">').text(articleHeadline);
    articleDiv.append(pOne);
    // console.log(articleHeadline);
   
    //article source, create <p> for source, append <p> to article div
    var articleSource = taco.response.docs[num].source;
    var pTwo = $('<p class="card-text ml-2">').text("Source: " + articleSource);
    articleDiv.append(pTwo);
    // console.log(articleSource);

    // same as above
    var articleSourceType = taco.response.docs[num].document_type;
    var pThree = $('<p class="card-text ml-2">').text("Article Type: " + articleSourceType);
    articleDiv.append(pThree);
    // console.log(articleSourceType);

    // same as above
    var publicationDate = taco.response.docs[num].pub_date;
    var pFour = $('<p class="card-text ml-2">').text("Publication Date: " + publicationDate);
    articleDiv.append(pFour);
    // console.log(publicationDate);

    // same as above
    var articleURL = taco.response.docs[num].web_url;
    var articleLink = $('<a class="card-link ml-2">')
      .attr("href", articleURL)
      .text("Click Here to View the Article");
    articleDiv.append(articleLink);
    // console.log(articleURL);

    $("#searchResults").append(articleDiv);
    }
  
  });
}

//This code is executed upon clicking the "submit" button on the screen
$("form").submit(function() {
    console.log(this);
  //NYT requires a full date in order to query the time period, so we use this to append to the year the users enter
  var startFix = "0101";
  var endFix = "1231";

  var apiKey = "OpiGwSGRDhbeATHeIQP5GmK2rSkCvNHE";
  //pulling from the boot strap form, and storing in variables to be strung together for queryURL
  var searchTerm = $("#searchTerm").val();
  var numRecords = $("#numRecords").val();
  var startYearEntry = $("#startDate").val();
  console.log(startYearEntry);
  var endYearEntry = $("#endDate").val();
  var startYear = startYearEntry + startFix;
  var endYear = endYearEntry + endFix;
  var queryURL =
    "https://api.nytimes.com/svc/search/v2/articlesearch.json?q=" + searchTerm +"&begin_date=" + startYear + "&end_date=" + endYear +  "&api-key=" + apiKey;
  console.log(queryURL);

  //Run the displaySearchInfo function, pass the queryURL generated by form.submit(), and display the articles to the HTML
  displaySearchInfo(queryURL,numRecords);

  //Return false is required so that the page does not refresh when you submit. If it did refresh, nothing would be displayed
  return false;
});

//function for clearing out the article div
$("#clearResults").on("click", function() {
  $("#searchResults").html("");
});
// 